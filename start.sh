#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∏ –ø–∞—Ä—Å–µ—Ä–∞

echo "üöÄ –ó–∞–ø—É—Å–∫ Facebook Job Parser..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üìù –°–æ–∑–¥–∞–π—Ç–µ .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.sample"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
python -c "import flask, telegram, facebook_scraper" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "‚ö†Ô∏è  –ù–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    pip install -r requirements.txt
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
mkdir -p data

echo "‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ!"
echo ""
echo "ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ API..."
python mini_app_bot.py &
BOT_PID=$!

sleep 3

echo "üåê –ó–∞–ø—É—Å–∫ Facebook –ø–∞—Ä—Å–µ—Ä–∞..."
python fb_parser.py &
PARSER_PID=$!

echo ""
echo "‚úÖ –ó–∞–ø—É—â–µ–Ω–æ!"
echo "ü§ñ –ë–æ—Ç PID: $BOT_PID"
echo "üåê –ü–∞—Ä—Å–µ—Ä PID: $PARSER_PID"
echo ""
echo "üìä –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait
